<!DOCTYPE html>
<html lang="mn">
<head>
  <meta charset="UTF-8">
  <title>–ú—É—É—à–∏–≥</title>
  <style>
    body {
      background-color: green;
      color: yellow;
      font-family: sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    #top {
      display: flex;
      justify-content: space-between;
      padding: 10px 40px;
      font-size: 20px;
      font-weight: bold;
    }
    #trump-area {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 10px 0;
    }
    #deck-card {
      transform: rotate(-15deg);
      margin-right: -40px;
    }
    #play-area {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 120px;
      margin: 10px;
    }
    #bot-hand, #player-hand {
      display: flex;
      justify-content: center;
      margin: 10px 0;
      min-height: 100px;
    }
    .card {
      width: 70px;
      height: auto;
      margin: 5px;
      cursor: pointer;
    }
    .selected {
      border: 3px solid yellow;
    }
    #controls {
      margin: 15px;
    }
    .btn {
      background: white;
      color: black;
      font-weight: bold;
      padding: 8px 16px;
      margin: 5px;
      cursor: pointer;
      border: none;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <div id="top">
    <div id="score-player">–¢–æ–≥–ª–æ–≥—á: 15</div>
    <div id="score-bot">–ë–æ—Ç: 15</div>
  </div>

  <div id="trump-area">
    <img id="deck-card" class="card" src="cards/card-back.png" alt="Deck">
    <img id="trump-card" class="card" src="cards/7H.png" alt="Trump">
  </div>

  <div id="play-area"></div>

  <div id="controls">
    <button class="btn" onclick="startGame()">–¢–û–ì–õ–û</button>
    <button class="btn" onclick="performSwap()">–°–û–õ–ò–•</button>
    <button class="btn" onclick="resetRound()">–®–ò–ù–≠</button>
  </div>

  <div id="bot-hand"></div>
  <div id="player-hand"></div>

  <script>
    const suits = ['H', 'D', 'S', 'C'];
    const ranks = ['7','8','9','10','J','Q','K','A'];
    let playerHand = [], botHand = [], deck = [], trumpCard = '';
    let playerScore = 15, botScore = 15;
    let selectedIndices = [];
    let currentTrick = 0;
    let gameStarted = false;
    let nextPlayer = 'player';

    function getRandomCardDeck() {
      const fullDeck = [];
      for (let s of suits) for (let r of ranks) fullDeck.push(r + s);
      for (let i = fullDeck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [fullDeck[i], fullDeck[j]] = [fullDeck[j], fullDeck[i]];
      }
      return fullDeck;
    }

    function updateScores() {
      document.getElementById('score-player').innerText = `–¢–æ–≥–ª–æ–≥—á: ${playerScore}`;
      document.getElementById('score-bot').innerText = `–ë–æ—Ç: ${botScore}`;
    }

    function startGame() {
      deck = getRandomCardDeck();
      playerHand = deck.splice(0, 5);
      botHand = deck.splice(0, 5);
      trumpCard = deck.pop();
      currentTrick = 0;
      gameStarted = false;
      nextPlayer = Math.random() > 0.5 ? 'player' : 'bot';
      document.getElementById('trump-card').src = `cards/${trumpCard}.png`;
      drawHands();
      if (nextPlayer === 'bot') setTimeout(botPlay, 1000);
    }

    function drawHands() {
      const playerDiv = document.getElementById('player-hand');
      const botDiv = document.getElementById('bot-hand');
      playerDiv.innerHTML = '';
      botDiv.innerHTML = '';

      playerHand.forEach((card, index) => {
        const img = document.createElement('img');
        img.src = `cards/${card}.png`;
        img.className = 'card';
        img.onclick = !gameStarted ? () => toggleSelect(index, img) : () => playCard(index);
        if (selectedIndices.includes(index)) img.classList.add('selected');
        playerDiv.appendChild(img);
      });

      botHand.forEach(() => {
        const img = document.createElement('img');
        img.src = 'cards/card-back.png';
        img.className = 'card';
        botDiv.appendChild(img);
      });
    }

    function toggleSelect(index, imgElement) {
      if (selectedIndices.includes(index)) {
        selectedIndices = selectedIndices.filter(i => i !== index);
        imgElement.classList.remove('selected');
      } else {
        selectedIndices.push(index);
        imgElement.classList.add('selected');
      }
    }

    function performSwap() {
      if (gameStarted || selectedIndices.length === 0) {
        alert("–≠—Ö–ª—ç—ç–¥ –°–û–õ–ò–• —Ç–æ–≤—á–æ–æ—Ä —Å–æ–ª–∏–Ω–æ —É—É!");
        return;
      }
      selectedIndices.sort((a, b) => b - a);
      for (let i of selectedIndices) {
        if (deck.length > 0) playerHand[i] = deck.pop();
      }
      selectedIndices = [];
      gameStarted = true;
      drawHands();
    }

    function playCard(index) {
      if (!gameStarted || nextPlayer !== 'player') return;
      const playerCard = playerHand.splice(index, 1)[0];
      const botCard = chooseBotCard(playerCard);
      botHand = botHand.filter(c => c !== botCard);
      showPlayedCards(playerCard, botCard);

      let winner = evaluateTrickWinner(playerCard, botCard);
      if (winner === 'player') botScore--;
      else playerScore--;

      nextPlayer = winner;
      updateScores();
      currentTrick++;

      setTimeout(() => {
        document.getElementById('play-area').innerHTML = '';
        drawHands();
        checkGameOver();
        if (nextPlayer === 'bot') botPlay();
      }, 2000);
    }

    function botPlay() {
      if (!gameStarted || botHand.length === 0 || playerHand.length === 0) return;
      const botCard = botHand.shift();
      const playerCard = playerHand.shift();
      showPlayedCards(playerCard, botCard);

      let winner = evaluateTrickWinner(playerCard, botCard);
      if (winner === 'player') botScore--;
      else playerScore--;

      nextPlayer = winner;
      updateScores();
      currentTrick++;

      setTimeout(() => {
        document.getElementById('play-area').innerHTML = '';
        drawHands();
        checkGameOver();
        if (nextPlayer === 'bot') botPlay();
      }, 2000);
    }

    // Enhanced bot strategy: pick the best matching card or fallback wisely
    function chooseBotCard(playerCard) {
      const playerSuit = playerCard.slice(-1);
      const playerValue = ranks.indexOf(playerCard.slice(0, -1));

      // Try to beat the card in same suit
      let candidates = botHand.filter(c => c.slice(-1) === playerSuit && ranks.indexOf(c.slice(0, -1)) > playerValue);
      candidates.sort((a, b) => ranks.indexOf(a.slice(0, -1)) - ranks.indexOf(b.slice(0, -1)));
      if (candidates.length > 0) return candidates[0];

      // Try using weakest trump
      const trumpSuit = trumpCard.slice(-1);
      candidates = botHand.filter(c => c.slice(-1) === trumpSuit);
      candidates.sort((a, b) => ranks.indexOf(a.slice(0, -1)) - ranks.indexOf(b.slice(0, -1)));
      if (candidates.length > 0) return candidates[0];

      // Give lowest card
      return botHand.slice().sort((a, b) => ranks.indexOf(a.slice(0, -1)) - ranks.indexOf(b.slice(0, -1)))[0];
    }

    function evaluateTrickWinner(pCard, bCard) {
      const pSuit = pCard.slice(-1), bSuit = bCard.slice(-1);
      const pValue = ranks.indexOf(pCard.slice(0, -1)), bValue = ranks.indexOf(bCard.slice(0, -1));
      if (pSuit === bSuit) return pValue > bValue ? 'player' : 'bot';
      if (bSuit === trumpCard.slice(-1)) return 'bot';
      if (pSuit === trumpCard.slice(-1)) return 'player';
      return 'player';
    }

    function showPlayedCards(playerCard, botCard) {
      const area = document.getElementById('play-area');
      area.innerHTML = '';
      const bImg = document.createElement('img');
      bImg.src = `cards/${botCard}.png`;
      bImg.className = 'card';
      const pImg = document.createElement('img');
      pImg.src = `cards/${playerCard}.png`;
      pImg.className = 'card';
      area.appendChild(bImg);
      area.appendChild(pImg);
    }

    function checkGameOver() {
      if (playerScore <= 0 || playerScore <= -4) {
        alert('üéâ –¢–æ–≥–ª–æ–≥—á —è–ª–∞–≤!');
        resetRound();
      } else if (botScore <= 0 || botScore <= -4) {
        alert('ü§ñ –ë–æ—Ç —è–ª–∞–≤!');
        resetRound();
      } else if (playerHand.length > 0 && botHand.length > 0) {
        if (nextPlayer === 'bot') {
          setTimeout(botPlay, 1000);
        }
      }
    }

    function resetRound() {
      playerHand = [];
      botHand = [];
      selectedIndices = [];
      document.getElementById('player-hand').innerHTML = '';
      document.getElementById('bot-hand').innerHTML = '';
      document.getElementById('play-area').innerHTML = '';
      updateScores();
    }
  </script>
</body>
</html>
